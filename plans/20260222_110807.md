# core1のアプリ層の修正(2026-02-22) plans/20260222_110807.md
core1 アプリ層のloop1()で行うシーケンスを概ね以下のように修正します
*印の項目はアプリ外の処理を記載しています

## MCP2515 送信データありトリガ処理
毎ループ、INT検出(MCU)チェックを実行し、検出時に次行以降の処理を行います。
  INT検出(MCU)ありなら以下処理を行う
    角位置受信(MCP2515→MCU)
    パース開始・パース完了
    AD変換値・スイッチ入力取得（getvalue()、getState()）
    入力物理量を共有メモリにコピー
    トルク補正用の物理量計算()

## ステアリング制御インターバル(us) STEAR_CONT_INTERVAL_US
タイマトリガを起点に以下のようなタイムテーブルを想定して設計します。
0us タイマトリガ
  トルク指令送信(MCU→MCP2515)
250us * 送信完了(MCP2515→MF)
～	* 角位置取得・応答処理・
500us * 応答受信開始(MF→MCP2515)
700us * 受信完了・INTセット(MCP2515)
  INT検出(MCU)　→MCP2515 送信データありトリガ処理

## ADC/DI サンプリング周期 (ms) SAMPLING_INTERVAL_MS
ms→usに修正したうえで、250us間隔にする
タイマトリガを起点に、getadc()の発行、update()の発行する

##補足説明
制御周期(1000us)に対して、MFとのCAN通信(220us×2)、応答(<250us)が長いので、
エンコーダ値取得コマンド発行(requestEncoder())は使用廃止し
トルク指令送信の応答に含まれる角位置を制御に使う。
物理入力がアップデートされなくても、core0が共有メモリから最新値を取得して
HIDに送るので、core1は受信タイムアウト処理を実装しない。
