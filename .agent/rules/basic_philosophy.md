# 設計哲学と共通ルール (`_common`)

このディレクトリのルールは、すべてのプロジェクトで共通して適用される「エージェントの基本人格」を定義します。

## 1. コミュニケーションと言語設定
- **思考・対話**: すべての思考プロセス、チャット応答、Task UI（TaskName, Status等）は**日本語**で行う。
- **ドキュメント**: 生成するドキュメント（readme.md, walkthrough.md, implementation_plan.md等）の本文はすべて**日本語**で記述する。
- **コードコメント**: コード内のコメントも技術的な慣習に反しない限り**日本語**で記述する。

## 2. 設計思想（疎結合と可読性）
- **疎結合 (Loose Coupling)**:
    - 機能単位でモジュール化し、互いの依存関係を最小限に抑える。
    - グローバル変数の多用を避け、引数や設定クラスを介したデータ受け渡しを行う。
- **可読性優先 (Readability First)**:
    - 誰が見ても一目で意図が伝わるコードを優先する。
    - 短くトリッキーなコードよりも、長くても構造が明快なコードを選択する。
    - 適切な変数名、関数名を命名し、マジックナンバーを排除する。

## 3. 仕様・設計ドキュメントの管理
プロジェクトを進行する際、以下の2層のドキュメントを維持・参照し、実装との整合性を保つ。

- **仕様概要書 (`SpecSummaryYYYYMMDD.txt`)**:
    - **役割**: ユーザーからエージェントへの「最上位の指示書」。プロジェクトの目的、全体構成、ハードウェア選定、主要な数値目標を記述する。
    - **運用**: 実装中に全体方針の迷いが生じた際、常に立ち返る「真実のソース」とする。
- **設計仕様書 (`*.md`)**:
    - **役割**: 各モジュール（AnalogInput, Charge, Discharge, PortIO等）の具体的な設計内容・数式・方針・制限事項を記述する。
    - **品質基準**: `templates/design_sheet_template.md` に基づき、以下の情報を網羅した「AIにとっての唯一の正解（Source of Truth）」として作成すること。
        - **背景と根拠**: なぜその実装を選んだか。
        - **インターフェース**: 関数・型・依存関係の厳格な定義。
        - **判断基準**: 環境特有の制約や技術的根拠。
        - **実装原則**: 絶対に守るべき手順や禁止事項。
    - **QA履歴の永続化**: チャットでの重要な議論や設計上の意思決定（Why）は、適宜このドキュメントの「設計根拠」セクション等に転記し、情報の断片化を防ぐ。
    - **運用**: コード作成前に関係するMDファイルを読み込み、その制約を満たしているか確認する。実装に変更があった場合は、必ず対応するMDファイルも更新する。

## 4. 開発プロセスと透明性
- **プロアクティブな確認**: 仕様の不明点や、複数の実装の選択肢がある場合は、勝手に進めず必ずユーザーに確認する。
- **ファイル経由のヒアリング（ヒアリングシート）**: 
    - ユーザーへの確認事項が**合計400文字を超える**場合や、複雑な仕様の詰めが必要な場合は、チャットではなくヒアリング用のファイル（`QA_YYYYMMDD.txt` または `.md`）を作成して提示する。
    - これにより、ユーザーの思考時間の確保、誤送信の防止、および意思決定の履歴管理を徹底する。
- **段階的な実装**: 大きな機能は小さなステップに分割し、ステップごとに動作確認やフィードバックを行う。
- **エラーハンドリング**: 「正常系」だけでなく、エラー時の挙動（ログ出力、リカバー処理）を必ずセットで設計する。

## 5. ファイル操作と Git 管理
- **破壊的変更の警告**: 既存の大規模なコードを削除・置換する場合は、その理由と影響を事前に説明する。
- **ディレクトリ構成の維持**: プロジェクト独自のフォルダ構造を尊重し、勝手に新しいトップレベルフォルダを作成しない。
- **Git 管理の使い分け**:
    - **テンプレートと設計仕様書**: 開発環境の標準および「真実のソース」として、Git で厳格に管理・共有する。
    - **一時ファイル（QAシート等）**: 原則として `.gitignore` に追加するか、結論を設計書などのドキュメントに転記した後は削除し、リポジトリをクリーンに保つ。
