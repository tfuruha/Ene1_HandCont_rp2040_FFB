# USB HID通信モジュール設計書 (HIDModule.md)

## 1. 目的
PCホストに対して、デバイスを標準的なゲームコントローラ（Joystick）として認識させ、低遅延で操作情報を送信する仕様を規定する。

## 2. デバイス構成
- **USBクラス**: HID (Human Interface Device)
- **ライブラリ**: `mheironimus/Joystick`
- **レポートID**: デフォルトを使用

## 3. レポート構造 (送信データ)
以下のデータを20ms周期でホストに送信する。

### 3.1 軸入力 (Axes)
| 軸名 | 役割 | 対応データレンジ | 備考 |
| :--- | :--- | :--- | :--- |
| Steering | ハンドル角度 | -5461 ～ 5461 | ±30度に相当 |
| Accelerator | アクセル量 | 160 ～ 840 | スロットル電圧に対応 |
| Brake | ブレーキ圧 | 100 ～ 820 | センサ分圧に対応（反転後） |

### 3.2 ボタン入力 (Buttons)
| ボタン番号 | 役割 | 入力ソース |
| :--- | :--- | :--- |
| Button 0 (nBtnUP) | Shift Up | S-Up Button (D6) |
| Button 1 (nBtnDOWN) | Shift Down | S-Down Button (D7) |

## 4. 特記事項
- **FFB受信 (将来課題)**: 現在は送信専用だが、将来的にはホストからの `Set Feature` レポート等を通じてFFBパケットを受け取る機能を拡張予定である。
- **デバッグ**: `Serial` 通信とUSB HID送信は独立して動作可能だが、パフォーマンス維持のため、本番動作時はシリアル出力を最小限に抑制する。
