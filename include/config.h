#ifndef CONFIG_H
#define CONFIG_H

/**
 * @file config.h
 * @brief Ene1_HandCont_rp2040_FFB プロジェクト全体の設定ファイル
 * @date 2026-01-23
 *
 * このファイルにはピンアサイン、通信設定、タイミング定数など、
 * プロジェクト全体で使用する定数を集約しています。
 * 各モジュールはこのファイルを参照し、ハードコードを避けてください。
 *
 * 仕様書: SpecSummary20260118.txt
 */

// ============================================================================
// ピンアサイン定義
// ============================================================================

// --- SPI通信ピン (MCP2515 CAN Controller) ---
#define PIN_CAN_CS 17  // MCP2515 Chip Select
#define PIN_SPI_SCK 18 // SPI Clock
#define PIN_SPI_TX 19  // SPI MOSI (TX)
#define PIN_SPI_RX 16  // SPI MISO (RX)

// --- デジタル入力ピン (シフトスイッチ) ---
#define PIN_SHIFT_UP 25   // シフトアップボタン (Active Low, 内部プルアップ)
#define PIN_SHIFT_DOWN 24 // シフトダウンボタン (Active Low, 内部プルアップ)

// --- アナログ入力ピン (ペダル) ---
#define PIN_BRAKE 26 // ADC0 - ブレーキペダル (面圧センサ)
#define PIN_ACCEL 27 // ADC1 - アクセルペダル (電圧出力)

// ============================================================================
// CAN通信設定
// ============================================================================

// --- MCP2515設定 ---
// 注: CAN通信の設定値は mcp2515.h で定義されている enum 型を使用します
// 実際の設定は mf4015.cpp の SetupMCP2515_MF() 関数内で行います
// 参考値: CAN_500KBPS (500kbps), MCP_8MHZ (8MHz クロック)

// --- MF4015 ステアリングモーター設定 ---
#define MF4015_CAN_ID 0x141 // MF4015のCAN ID (0x140 + ID1)
#define MF4015_DEVICE_ID 1  // MF4015デバイスID (1-32)

// --- MF4015 角度範囲 ---
#define MF4015_ANGLE_MIN -5461 // 有効角度範囲 最小値 (-30度相当)
#define MF4015_ANGLE_MAX 5461  // 有効角度範囲 最大値 (+30度相当)
#define MF4015_ANGLE_CENTER 0  // センター位置

// --- MF4015 トルク範囲 ---
#define MF4015_TORQUE_MIN -2048 // トルク電流指令値 最小
#define MF4015_TORQUE_MAX 2048  // トルク電流指令値 最大

// ============================================================================
// タイミング設定
// ============================================================================

#define SAMPLING_INTERVAL_MS 2 // ADC/DI サンプリング周期 (ms)
#define MAIN_INTERVAL_MS 20    // HIDレポート送信周期 (ms)

// ============================================================================
// アナログ入力設定
// ============================================================================

// --- アクセルペダル (電圧入力 0.5V - 2.8V) ---
#define ACCEL_ADC_MIN 160 // ADC最小値 (10bit基準)
#define ACCEL_ADC_MAX 840 // ADC最大値 (10bit基準)

// --- ブレーキペダル (プルアップ抵抗式面圧センサ) ---
#define BRAKE_ADC_MIN 100 // ADC最小値 (10bit基準)
#define BRAKE_ADC_MAX 820 // ADC最大値 (10bit基準)
#define BRAKE_INVERT true // 踏み込み時にADC値が下がるため反転処理が必要

// --- 移動平均フィルタ設定 ---
#define ADC_BUFFER_SIZE 20  // 移動平均バッファサイズ
#define ADC_AVERAGE_COUNT 8 // 移動平均サンプル数

// ============================================================================
// デジタル入力設定
// ============================================================================

// --- チャタリング防止 ---
#define BUTTON_DEBOUNCE_THRESHOLD 4 // 連続一致サンプル数

// ============================================================================
// USB HID設定
// ============================================================================

#define HID_BUTTON_COUNT 2 // ボタン数 (UP: Button 0, DOWN: Button 1)
#define HID_AXIS_COUNT 3   // 軸数 (Steering, Accelerator, Brake)

// ============================================================================
// システム設定
// ============================================================================

#define SERIAL_BAUDRATE 115200 // シリアル通信ボーレート (デバッグ用)

#endif // CONFIG_H
